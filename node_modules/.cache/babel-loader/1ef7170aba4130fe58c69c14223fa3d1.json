{"ast":null,"code":"import _toConsumableArray from\"/Users/jalcantara/Desktop/SOL-dev/tanda-wallet-sol/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _slicedToArray from\"/Users/jalcantara/Desktop/SOL-dev/tanda-wallet-sol/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{generateMnemonicAndSeed,useHasLockedMnemonicAndSeed,loadMnemonicAndSeed,mnemonicToSeed,storeMnemonicAndSeed,normalizeMnemonic}from'../utils/wallet-seed';import{getAccountFromSeed,DERIVATION_PATH}from'../utils/walletProvider/localStorage.js';import Container from'@material-ui/core/Container';import LoadingIndicator from'../components/LoadingIndicator';import{BalanceListItem}from'../components/BalancesList.js';import Card from'@material-ui/core/Card';import CardContent from'@material-ui/core/CardContent';import{DialogActions,DialogContentText,DialogTitle,Typography}from'@material-ui/core';import TextField from'@material-ui/core/TextField';import Checkbox from'@material-ui/core/Checkbox';import FormControl from'@material-ui/core/FormControl';import FormControlLabel from'@material-ui/core/FormControlLabel';import CardActions from'@material-ui/core/CardActions';import Button from'@material-ui/core/Button';import Select from'@material-ui/core/Select';import MenuItem from'@material-ui/core/MenuItem';import{useCallAsync}from'../utils/notifications';import Link from'@material-ui/core/Link';import{validateMnemonic}from'bip39';import DialogForm from'../components/DialogForm';export default function LoginPage(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),restore=_useState2[0],setRestore=_useState2[1];var _useHasLockedMnemonic=useHasLockedMnemonicAndSeed(),_useHasLockedMnemonic2=_slicedToArray(_useHasLockedMnemonic,2),hasLockedMnemonicAndSeed=_useHasLockedMnemonic2[0],loading=_useHasLockedMnemonic2[1];if(loading){return null;}return/*#__PURE__*/_jsx(Container,{maxWidth:\"sm\",children:restore?/*#__PURE__*/_jsx(RestoreWalletForm,{goBack:function goBack(){return setRestore(false);}}):/*#__PURE__*/_jsxs(_Fragment,{children:[hasLockedMnemonicAndSeed?/*#__PURE__*/_jsx(LoginForm,{}):/*#__PURE__*/_jsx(CreateWalletForm,{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Link,{style:{cursor:'pointer'},onClick:function onClick(){return setRestore(true);},children:\"Restore existing wallet\"})]})});}function CreateWalletForm(){var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),mnemonicAndSeed=_useState4[0],setMnemonicAndSeed=_useState4[1];useEffect(function(){generateMnemonicAndSeed().then(setMnemonicAndSeed);},[]);var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),savedWords=_useState6[0],setSavedWords=_useState6[1];var callAsync=useCallAsync();function submit(password){var mnemonic=mnemonicAndSeed.mnemonic,seed=mnemonicAndSeed.seed;callAsync(storeMnemonicAndSeed(mnemonic,seed,password,DERIVATION_PATH.bip44Change),{progressMessage:'Creating wallet...',successMessage:'Wallet created'});}if(!savedWords){return/*#__PURE__*/_jsx(SeedWordsForm,{mnemonicAndSeed:mnemonicAndSeed,goForward:function goForward(){return setSavedWords(true);}});}return/*#__PURE__*/_jsx(ChoosePasswordForm,{mnemonicAndSeed:mnemonicAndSeed,goBack:function goBack(){return setSavedWords(false);},onSubmit:submit});}function SeedWordsForm(_ref){var mnemonicAndSeed=_ref.mnemonicAndSeed,goForward=_ref.goForward;var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),confirmed=_useState8[0],setConfirmed=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),downloaded=_useState10[0],setDownloaded=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),showDialog=_useState12[0],setShowDialog=_useState12[1];var _useState13=useState(''),_useState14=_slicedToArray(_useState13,2),seedCheck=_useState14[0],setSeedCheck=_useState14[1];var downloadMnemonic=function downloadMnemonic(mnemonic){var url=window.URL.createObjectURL(new Blob([mnemonic]));var link=document.createElement('a');link.href=url;link.setAttribute('download','sollet.bak');document.body.appendChild(link);link.click();};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",gutterBottom:true,children:\"Create New Wallet\"}),/*#__PURE__*/_jsx(Typography,{paragraph:true,children:\"Create a new wallet to hold Solana and SPL tokens.\"}),/*#__PURE__*/_jsx(Typography,{children:\"Please write down the following twenty four words and keep them in a safe place:\"}),mnemonicAndSeed?/*#__PURE__*/_jsx(TextField,{variant:\"outlined\",fullWidth:true,multiline:true,margin:\"normal\",value:mnemonicAndSeed.mnemonic,label:\"Seed Words\",onFocus:function onFocus(e){return e.currentTarget.select();}}):/*#__PURE__*/_jsx(LoadingIndicator,{}),/*#__PURE__*/_jsx(Typography,{paragraph:true,children:\"Your private keys are only stored on your current computer or device. You will need these words to restore your wallet if your browser's storage is cleared or your device is damaged or lost.\"}),/*#__PURE__*/_jsxs(Typography,{paragraph:true,children:[\"By default, sollet will use \",/*#__PURE__*/_jsx(\"code\",{children:\"m/44'/501'/0'/0'\"}),\" as the derivation path for the main wallet. To use an alternative path, try restoring an existing wallet.\"]}),/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Checkbox,{checked:confirmed,disabled:!mnemonicAndSeed,onChange:function onChange(e){return setConfirmed(e.target.checked);}}),label:\"I have saved these words in a safe place.\"}),/*#__PURE__*/_jsx(Typography,{paragraph:true,children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",style:{marginTop:20},onClick:function onClick(){downloadMnemonic(mnemonicAndSeed===null||mnemonicAndSeed===void 0?void 0:mnemonicAndSeed.mnemonic);setDownloaded(true);},children:\"Download Backup Mnemonic File (Required)\"})})]}),/*#__PURE__*/_jsx(CardActions,{style:{justifyContent:'flex-end'},children:/*#__PURE__*/_jsx(Button,{color:\"primary\",disabled:!confirmed||!downloaded,onClick:function onClick(){return setShowDialog(true);},children:\"Continue\"})})]}),/*#__PURE__*/_jsxs(DialogForm,{open:showDialog,onClose:function onClose(){return setShowDialog(false);},onSubmit:goForward,fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:'Confirm Mnemonic'}),/*#__PURE__*/_jsxs(DialogContentText,{style:{margin:20},children:[/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',flexDirection:'column'},children:\"Please re-enter your seed phrase to confirm that you have saved it.\"}),/*#__PURE__*/_jsx(TextField,{label:\"Please type your seed phrase to confirm\",fullWidth:true,variant:\"outlined\",margin:\"normal\",value:seedCheck,onChange:function onChange(e){return setSeedCheck(e.target.value);}})]}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:function onClick(){return setShowDialog(false);},children:\"Close\"}),/*#__PURE__*/_jsx(Button,{type:\"submit\",color:\"secondary\",disabled:normalizeMnemonic(seedCheck)!==(mnemonicAndSeed===null||mnemonicAndSeed===void 0?void 0:mnemonicAndSeed.mnemonic),children:\"Continue\"})]})]})]});}function ChoosePasswordForm(_ref2){var goBack=_ref2.goBack,onSubmit=_ref2.onSubmit;var _useState15=useState(''),_useState16=_slicedToArray(_useState15,2),password=_useState16[0],setPassword=_useState16[1];var _useState17=useState(''),_useState18=_slicedToArray(_useState17,2),passwordConfirm=_useState18[0],setPasswordConfirm=_useState18[1];return/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",gutterBottom:true,children:\"Choose a Password (Optional)\"}),/*#__PURE__*/_jsx(Typography,{children:\"Optionally pick a password to protect your wallet.\"}),/*#__PURE__*/_jsx(TextField,{variant:\"outlined\",fullWidth:true,margin:\"normal\",label:\"New Password\",type:\"password\",autoComplete:\"new-password\",value:password,onChange:function onChange(e){return setPassword(e.target.value);}}),/*#__PURE__*/_jsx(TextField,{variant:\"outlined\",fullWidth:true,margin:\"normal\",label:\"Confirm Password\",type:\"password\",autoComplete:\"new-password\",value:passwordConfirm,onChange:function onChange(e){return setPasswordConfirm(e.target.value);}}),/*#__PURE__*/_jsx(Typography,{children:\"If you forget your password you will need to restore your wallet using your seed words.\"})]}),/*#__PURE__*/_jsxs(CardActions,{style:{justifyContent:'space-between'},children:[/*#__PURE__*/_jsx(Button,{onClick:goBack,children:\"Back\"}),/*#__PURE__*/_jsx(Button,{color:\"primary\",disabled:password!==passwordConfirm,onClick:function onClick(){return onSubmit(password);},children:\"Create Wallet\"})]})]});}function LoginForm(){var _useState19=useState(''),_useState20=_slicedToArray(_useState19,2),password=_useState20[0],setPassword=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),stayLoggedIn=_useState22[0],setStayLoggedIn=_useState22[1];var callAsync=useCallAsync();var submit=function submit(){callAsync(loadMnemonicAndSeed(password,stayLoggedIn),{progressMessage:'Unlocking wallet...',successMessage:'Wallet unlocked'});};var submitOnEnter=function submitOnEnter(e){if(e.code===\"Enter\"||e.code===\"NumpadEnter\"){e.preventDefault();e.stopPropagation();submit();}};var setPasswordOnChange=function setPasswordOnChange(e){return setPassword(e.target.value);};var toggleStayLoggedIn=function toggleStayLoggedIn(e){return setStayLoggedIn(e.target.checked);};return/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",gutterBottom:true,children:\"Unlock Wallet\"}),/*#__PURE__*/_jsx(TextField,{variant:\"outlined\",fullWidth:true,margin:\"normal\",label:\"Password\",type:\"password\",autoComplete:\"current-password\",value:password,onChange:setPasswordOnChange,onKeyDown:submitOnEnter}),/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Checkbox,{checked:stayLoggedIn,onChange:toggleStayLoggedIn}),label:\"Keep wallet unlocked\"})]}),/*#__PURE__*/_jsx(CardActions,{style:{justifyContent:'flex-end'},children:/*#__PURE__*/_jsx(Button,{color:\"primary\",onClick:submit,children:\"Unlock\"})})]});}function RestoreWalletForm(_ref3){var goBack=_ref3.goBack;var _useState23=useState(''),_useState24=_slicedToArray(_useState23,2),rawMnemonic=_useState24[0],setRawMnemonic=_useState24[1];var _useState25=useState(''),_useState26=_slicedToArray(_useState25,2),seed=_useState26[0],setSeed=_useState26[1];var _useState27=useState(''),_useState28=_slicedToArray(_useState27,2),password=_useState28[0],setPassword=_useState28[1];var _useState29=useState(''),_useState30=_slicedToArray(_useState29,2),passwordConfirm=_useState30[0],setPasswordConfirm=_useState30[1];var _useState31=useState(false),_useState32=_slicedToArray(_useState31,2),next=_useState32[0],setNext=_useState32[1];var mnemonic=normalizeMnemonic(rawMnemonic);var isNextBtnEnabled=password===passwordConfirm&&validateMnemonic(mnemonic);var displayInvalidMnemonic=validateMnemonic(mnemonic)===false&&mnemonic.length>0;return/*#__PURE__*/_jsx(_Fragment,{children:next?/*#__PURE__*/_jsx(DerivedAccounts,{goBack:function goBack(){return setNext(false);},mnemonic:mnemonic,password:password,seed:seed}):/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",gutterBottom:true,children:\"Restore Existing Wallet\"}),/*#__PURE__*/_jsx(Typography,{children:\"Restore your wallet using your twelve or twenty-four seed words. Note that this will delete any existing wallet on this device.\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(Typography,{fontWeight:\"fontWeightBold\",children:[/*#__PURE__*/_jsx(\"b\",{children:\"Do not enter your hardware wallet seedphrase here.\"}),\" Hardware wallets can be optionally connected after a web wallet is created.\"]}),displayInvalidMnemonic&&/*#__PURE__*/_jsx(Typography,{fontWeight:\"fontWeightBold\",style:{color:'red'},children:\"Mnemonic validation failed. Please enter a valid BIP 39 seed phrase.\"}),/*#__PURE__*/_jsx(TextField,{variant:\"outlined\",fullWidth:true,multiline:true,rows:3,margin:\"normal\",label:\"Seed Words\",value:rawMnemonic,onChange:function onChange(e){return setRawMnemonic(e.target.value);}}),/*#__PURE__*/_jsx(TextField,{variant:\"outlined\",fullWidth:true,margin:\"normal\",label:\"New Password (Optional)\",type:\"password\",autoComplete:\"new-password\",value:password,onChange:function onChange(e){return setPassword(e.target.value);}}),/*#__PURE__*/_jsx(TextField,{variant:\"outlined\",fullWidth:true,margin:\"normal\",label:\"Confirm Password\",type:\"password\",autoComplete:\"new-password\",value:passwordConfirm,onChange:function onChange(e){return setPasswordConfirm(e.target.value);}})]}),/*#__PURE__*/_jsxs(CardActions,{style:{justifyContent:'space-between'},children:[/*#__PURE__*/_jsx(Button,{onClick:goBack,children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{color:\"primary\",disabled:!isNextBtnEnabled,onClick:function onClick(){mnemonicToSeed(mnemonic).then(function(seed){setSeed(seed);setNext(true);});},children:\"Next\"})]})]})});}function DerivedAccounts(_ref4){var goBack=_ref4.goBack,mnemonic=_ref4.mnemonic,seed=_ref4.seed,password=_ref4.password;var callAsync=useCallAsync();var _useState33=useState(DerivationPathMenuItem.Bip44Change),_useState34=_slicedToArray(_useState33,2),dPathMenuItem=_useState34[0],setDPathMenuItem=_useState34[1];var accounts=_toConsumableArray(Array(10)).map(function(_,idx){return getAccountFromSeed(Buffer.from(seed,'hex'),idx,toDerivationPath(dPathMenuItem));});function submit(){callAsync(storeMnemonicAndSeed(mnemonic,seed,password,toDerivationPath(dPathMenuItem)));}return/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(AccountsSelector,{showDeprecated:true,accounts:accounts,dPathMenuItem:dPathMenuItem,setDPathMenuItem:setDPathMenuItem}),/*#__PURE__*/_jsxs(CardActions,{style:{justifyContent:'space-between'},children:[/*#__PURE__*/_jsx(Button,{onClick:goBack,children:\"Back\"}),/*#__PURE__*/_jsx(Button,{color:\"primary\",onClick:submit,children:\"Restore\"})]})]});}export function AccountsSelector(_ref5){var showRoot=_ref5.showRoot,showDeprecated=_ref5.showDeprecated,accounts=_ref5.accounts,dPathMenuItem=_ref5.dPathMenuItem,setDPathMenuItem=_ref5.setDPathMenuItem,onClick=_ref5.onClick;return/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",gutterBottom:true,children:\"Derivable Accounts\"}),/*#__PURE__*/_jsx(FormControl,{variant:\"outlined\",children:/*#__PURE__*/_jsxs(Select,{value:dPathMenuItem,onChange:function onChange(e){setDPathMenuItem(e.target.value);},children:[showRoot&&/*#__PURE__*/_jsx(MenuItem,{value:DerivationPathMenuItem.Bip44Root,children:\"m/44'/501'\"}),/*#__PURE__*/_jsx(MenuItem,{value:DerivationPathMenuItem.Bip44,children:\"m/44'/501'/0'\"}),/*#__PURE__*/_jsx(MenuItem,{value:DerivationPathMenuItem.Bip44Change,children:\"m/44'/501'/0'/0'\"}),showDeprecated&&/*#__PURE__*/_jsx(MenuItem,{value:DerivationPathMenuItem.Deprecated,children:\"m/501'/0'/0/0 (deprecated)\"})]})})]}),accounts.map(function(acc){return/*#__PURE__*/_jsx(\"div\",{onClick:onClick?function(){return onClick(acc);}:{},children:/*#__PURE__*/_jsx(BalanceListItem,{onClick:onClick,publicKey:acc.publicKey,expandable:false},acc.publicKey.toString())});})]});}// Material UI's Select doesn't render properly when using an `undefined` value,\n// so we define this type and the subsequent `toDerivationPath` translator as a\n// workaround.\n//\n// DERIVATION_PATH.deprecated is always undefined.\nexport var DerivationPathMenuItem={Deprecated:0,Bip44:1,Bip44Change:2,Bip44Root:3// Ledger only.\n};export function toDerivationPath(dPathMenuItem){switch(dPathMenuItem){case DerivationPathMenuItem.Deprecated:return DERIVATION_PATH.deprecated;case DerivationPathMenuItem.Bip44:return DERIVATION_PATH.bip44;case DerivationPathMenuItem.Bip44Change:return DERIVATION_PATH.bip44Change;case DerivationPathMenuItem.Bip44Root:return DERIVATION_PATH.bip44Root;default:throw new Error(\"invalid derivation path: \".concat(dPathMenuItem));}}","map":{"version":3,"sources":["/Users/jalcantara/Desktop/SOL-dev/tanda-wallet-sol/src/pages/LoginPage.js"],"names":["React","useEffect","useState","generateMnemonicAndSeed","useHasLockedMnemonicAndSeed","loadMnemonicAndSeed","mnemonicToSeed","storeMnemonicAndSeed","normalizeMnemonic","getAccountFromSeed","DERIVATION_PATH","Container","LoadingIndicator","BalanceListItem","Card","CardContent","DialogActions","DialogContentText","DialogTitle","Typography","TextField","Checkbox","FormControl","FormControlLabel","CardActions","Button","Select","MenuItem","useCallAsync","Link","validateMnemonic","DialogForm","LoginPage","restore","setRestore","hasLockedMnemonicAndSeed","loading","cursor","CreateWalletForm","mnemonicAndSeed","setMnemonicAndSeed","then","savedWords","setSavedWords","callAsync","submit","password","mnemonic","seed","bip44Change","progressMessage","successMessage","SeedWordsForm","goForward","confirmed","setConfirmed","downloaded","setDownloaded","showDialog","setShowDialog","seedCheck","setSeedCheck","downloadMnemonic","url","window","URL","createObjectURL","Blob","link","document","createElement","href","setAttribute","body","appendChild","click","e","currentTarget","select","target","checked","marginTop","justifyContent","margin","display","flexDirection","value","ChoosePasswordForm","goBack","onSubmit","setPassword","passwordConfirm","setPasswordConfirm","LoginForm","stayLoggedIn","setStayLoggedIn","submitOnEnter","code","preventDefault","stopPropagation","setPasswordOnChange","toggleStayLoggedIn","RestoreWalletForm","rawMnemonic","setRawMnemonic","setSeed","next","setNext","isNextBtnEnabled","displayInvalidMnemonic","length","color","DerivedAccounts","DerivationPathMenuItem","Bip44Change","dPathMenuItem","setDPathMenuItem","accounts","Array","map","_","idx","Buffer","from","toDerivationPath","AccountsSelector","showRoot","showDeprecated","onClick","Bip44Root","Bip44","Deprecated","acc","publicKey","toString","deprecated","bip44","bip44Root","Error"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport {\n  generateMnemonicAndSeed,\n  useHasLockedMnemonicAndSeed,\n  loadMnemonicAndSeed,\n  mnemonicToSeed,\n  storeMnemonicAndSeed,\n  normalizeMnemonic,\n} from '../utils/wallet-seed';\nimport {\n  getAccountFromSeed,\n  DERIVATION_PATH,\n} from '../utils/walletProvider/localStorage.js';\nimport Container from '@material-ui/core/Container';\nimport LoadingIndicator from '../components/LoadingIndicator';\nimport { BalanceListItem } from '../components/BalancesList.js';\nimport Card from '@material-ui/core/Card';\nimport CardContent from '@material-ui/core/CardContent';\nimport { DialogActions, DialogContentText, DialogTitle, Typography } from '@material-ui/core';\nimport TextField from '@material-ui/core/TextField';\nimport Checkbox from '@material-ui/core/Checkbox';\nimport FormControl from '@material-ui/core/FormControl';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport CardActions from '@material-ui/core/CardActions';\nimport Button from '@material-ui/core/Button';\nimport Select from '@material-ui/core/Select';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport { useCallAsync } from '../utils/notifications';\nimport Link from '@material-ui/core/Link';\nimport { validateMnemonic } from 'bip39';\nimport DialogForm from '../components/DialogForm';\n\nexport default function LoginPage() {\n  const [restore, setRestore] = useState(false);\n  const [hasLockedMnemonicAndSeed, loading] = useHasLockedMnemonicAndSeed();\n\n  if (loading) {\n    return null;\n  }\n\n  return (\n    <Container maxWidth=\"sm\">\n      {restore ? (\n        <RestoreWalletForm goBack={() => setRestore(false)} />\n      ) : (\n        <>\n          {hasLockedMnemonicAndSeed ? <LoginForm /> : <CreateWalletForm />}\n          <br />\n          <Link style={{ cursor: 'pointer' }} onClick={() => setRestore(true)}>\n            Restore existing wallet\n          </Link>\n        </>\n      )}\n    </Container>\n  );\n}\n\nfunction CreateWalletForm() {\n  const [mnemonicAndSeed, setMnemonicAndSeed] = useState(null);\n  useEffect(() => {\n    generateMnemonicAndSeed().then(setMnemonicAndSeed);\n  }, []);\n  const [savedWords, setSavedWords] = useState(false);\n  const callAsync = useCallAsync();\n\n  function submit(password) {\n    const { mnemonic, seed } = mnemonicAndSeed;\n    callAsync(\n      storeMnemonicAndSeed(\n        mnemonic,\n        seed,\n        password,\n        DERIVATION_PATH.bip44Change,\n      ),\n      {\n        progressMessage: 'Creating wallet...',\n        successMessage: 'Wallet created',\n      },\n    );\n  }\n\n  if (!savedWords) {\n    return (\n      <SeedWordsForm\n        mnemonicAndSeed={mnemonicAndSeed}\n        goForward={() => setSavedWords(true)}\n      />\n    );\n  }\n\n  return (\n    <ChoosePasswordForm\n      mnemonicAndSeed={mnemonicAndSeed}\n      goBack={() => setSavedWords(false)}\n      onSubmit={submit}\n    />\n  );\n}\n\nfunction SeedWordsForm({ mnemonicAndSeed, goForward }) {\n  const [confirmed, setConfirmed] = useState(false);\n  const [downloaded, setDownloaded] = useState(false);\n  const [showDialog, setShowDialog] = useState(false);\n  const [seedCheck, setSeedCheck] = useState('');\n\n  const downloadMnemonic = (mnemonic) => {\n    const url = window.URL.createObjectURL(new Blob([mnemonic]));\n    const link = document.createElement('a');\n    link.href = url;\n    link.setAttribute('download', 'sollet.bak');\n    document.body.appendChild(link);\n    link.click();\n  }\n\n  return (\n    <>\n      <Card>\n        <CardContent>\n          <Typography variant=\"h5\" gutterBottom>\n            Create New Wallet\n          </Typography>\n          <Typography paragraph>\n            Create a new wallet to hold Solana and SPL tokens.\n          </Typography>\n          <Typography>\n            Please write down the following twenty four words and keep them in a\n            safe place:\n          </Typography>\n          {mnemonicAndSeed ? (\n            <TextField\n              variant=\"outlined\"\n              fullWidth\n              multiline\n              margin=\"normal\"\n              value={mnemonicAndSeed.mnemonic}\n              label=\"Seed Words\"\n              onFocus={(e) => e.currentTarget.select()}\n            />\n          ) : (\n            <LoadingIndicator />\n          )}\n          <Typography paragraph>\n            Your private keys are only stored on your current computer or device.\n            You will need these words to restore your wallet if your browser's\n            storage is cleared or your device is damaged or lost.\n          </Typography>\n          <Typography paragraph>\n            By default, sollet will use <code>m/44'/501'/0'/0'</code> as the\n            derivation path for the main wallet. To use an alternative path, try\n            restoring an existing wallet.\n          </Typography>\n          <FormControlLabel\n            control={\n              <Checkbox\n                checked={confirmed}\n                disabled={!mnemonicAndSeed}\n                onChange={(e) => setConfirmed(e.target.checked)}\n              />\n            }\n            label=\"I have saved these words in a safe place.\"\n          />\n          <Typography paragraph>\n          <Button variant=\"contained\" color=\"primary\" style={{ marginTop: 20 }} onClick={() => {\n            downloadMnemonic(mnemonicAndSeed?.mnemonic);\n            setDownloaded(true);\n          }}>\n            Download Backup Mnemonic File (Required)\n          </Button>\n          </Typography>\n        </CardContent>\n        <CardActions style={{ justifyContent: 'flex-end' }}>\n          <Button color=\"primary\" disabled={!confirmed || !downloaded} onClick={() => setShowDialog(true)}>\n            Continue\n          </Button>\n        </CardActions>\n      </Card>\n      <DialogForm\n        open={showDialog}\n        onClose={() => setShowDialog(false)}\n        onSubmit={goForward}\n        fullWidth\n      >\n        <DialogTitle>{'Confirm Mnemonic'}</DialogTitle>\n        <DialogContentText style={{ margin: 20 }}>\n          <div\n            style={{\n              display: 'flex',\n              flexDirection: 'column',\n            }}\n          >\n            Please re-enter your seed phrase to confirm that you have saved it.\n          </div>\n          <TextField\n            label={`Please type your seed phrase to confirm`}\n            fullWidth\n            variant=\"outlined\"\n            margin=\"normal\"\n            value={seedCheck}\n            onChange={(e) => setSeedCheck(e.target.value)}\n          />\n        </DialogContentText>\n        <DialogActions>\n          <Button onClick={() => setShowDialog(false)}>Close</Button>\n          <Button\n            type=\"submit\"\n            color=\"secondary\"\n            disabled={normalizeMnemonic(seedCheck) !== mnemonicAndSeed?.mnemonic}\n          >\n            Continue\n          </Button>\n        </DialogActions>\n      </DialogForm>\n    </>\n  );\n}\n\nfunction ChoosePasswordForm({ goBack, onSubmit }) {\n  const [password, setPassword] = useState('');\n  const [passwordConfirm, setPasswordConfirm] = useState('');\n\n  return (\n    <Card>\n      <CardContent>\n        <Typography variant=\"h5\" gutterBottom>\n          Choose a Password (Optional)\n        </Typography>\n        <Typography>\n          Optionally pick a password to protect your wallet.\n        </Typography>\n        <TextField\n          variant=\"outlined\"\n          fullWidth\n          margin=\"normal\"\n          label=\"New Password\"\n          type=\"password\"\n          autoComplete=\"new-password\"\n          value={password}\n          onChange={(e) => setPassword(e.target.value)}\n        />\n        <TextField\n          variant=\"outlined\"\n          fullWidth\n          margin=\"normal\"\n          label=\"Confirm Password\"\n          type=\"password\"\n          autoComplete=\"new-password\"\n          value={passwordConfirm}\n          onChange={(e) => setPasswordConfirm(e.target.value)}\n        />\n        <Typography>\n          If you forget your password you will need to restore your wallet using\n          your seed words.\n        </Typography>\n      </CardContent>\n      <CardActions style={{ justifyContent: 'space-between' }}>\n        <Button onClick={goBack}>Back</Button>\n        <Button\n          color=\"primary\"\n          disabled={password !== passwordConfirm}\n          onClick={() => onSubmit(password)}\n        >\n          Create Wallet\n        </Button>\n      </CardActions>\n    </Card>\n  );\n}\n\nfunction LoginForm() {\n  const [password, setPassword] = useState('');\n  const [stayLoggedIn, setStayLoggedIn] = useState(false);\n  const callAsync = useCallAsync();\n\n  const submit = () => {\n    callAsync(loadMnemonicAndSeed(password, stayLoggedIn), {\n      progressMessage: 'Unlocking wallet...',\n      successMessage: 'Wallet unlocked',\n    });\n  }\n  const submitOnEnter = (e) => {\n    if (e.code === \"Enter\" || e.code === \"NumpadEnter\") {\n      e.preventDefault();\n      e.stopPropagation();\n      submit();\n    }\n  }\n  const setPasswordOnChange = (e) => setPassword(e.target.value);\n  const toggleStayLoggedIn = (e) => setStayLoggedIn(e.target.checked);\n\n  return (\n    <Card>\n      <CardContent>\n        <Typography variant=\"h5\" gutterBottom>\n          Unlock Wallet\n        </Typography>\n        <TextField\n          variant=\"outlined\"\n          fullWidth\n          margin=\"normal\"\n          label=\"Password\"\n          type=\"password\"\n          autoComplete=\"current-password\"\n          value={password}\n          onChange={setPasswordOnChange}\n          onKeyDown={submitOnEnter}\n        />\n        <FormControlLabel\n          control={\n            <Checkbox\n              checked={stayLoggedIn}\n              onChange={toggleStayLoggedIn}\n            />\n          }\n          label=\"Keep wallet unlocked\"\n        />\n      </CardContent>\n      <CardActions style={{ justifyContent: 'flex-end' }}>\n        <Button color=\"primary\" onClick={submit}>\n          Unlock\n        </Button>\n      </CardActions>\n    </Card>\n  );\n}\n\nfunction RestoreWalletForm({ goBack }) {\n  const [rawMnemonic, setRawMnemonic] = useState('');\n  const [seed, setSeed] = useState('');\n  const [password, setPassword] = useState('');\n  const [passwordConfirm, setPasswordConfirm] = useState('');\n  const [next, setNext] = useState(false);\n\n  const mnemonic = normalizeMnemonic(rawMnemonic);\n  const isNextBtnEnabled =\n    password === passwordConfirm && validateMnemonic(mnemonic);\n  const displayInvalidMnemonic = validateMnemonic(mnemonic) === false && mnemonic.length > 0;\n  return (\n    <>\n      {next ? (\n        <DerivedAccounts\n          goBack={() => setNext(false)}\n          mnemonic={mnemonic}\n          password={password}\n          seed={seed}\n        />\n      ) : (\n        <Card>\n          <CardContent>\n            <Typography variant=\"h5\" gutterBottom>\n              Restore Existing Wallet\n            </Typography>\n            <Typography>\n              Restore your wallet using your twelve or twenty-four seed words.\n              Note that this will delete any existing wallet on this device.\n            </Typography>\n            <br />\n            <Typography fontWeight=\"fontWeightBold\">\n              <b>Do not enter your hardware wallet seedphrase here.</b> Hardware\n              wallets can be optionally connected after a web wallet is created.\n            </Typography>\n            {displayInvalidMnemonic && (\n               <Typography fontWeight=\"fontWeightBold\" style={{ color: 'red' }}>\n                 Mnemonic validation failed. Please enter a valid BIP 39 seed phrase.\n               </Typography>\n            )}\n            <TextField\n              variant=\"outlined\"\n              fullWidth\n              multiline\n              rows={3}\n              margin=\"normal\"\n              label=\"Seed Words\"\n              value={rawMnemonic}\n              onChange={(e) => setRawMnemonic(e.target.value)}\n            />\n            <TextField\n              variant=\"outlined\"\n              fullWidth\n              margin=\"normal\"\n              label=\"New Password (Optional)\"\n              type=\"password\"\n              autoComplete=\"new-password\"\n              value={password}\n              onChange={(e) => setPassword(e.target.value)}\n            />\n            <TextField\n              variant=\"outlined\"\n              fullWidth\n              margin=\"normal\"\n              label=\"Confirm Password\"\n              type=\"password\"\n              autoComplete=\"new-password\"\n              value={passwordConfirm}\n              onChange={(e) => setPasswordConfirm(e.target.value)}\n            />\n          </CardContent>\n          <CardActions style={{ justifyContent: 'space-between' }}>\n            <Button onClick={goBack}>Cancel</Button>\n            <Button\n              color=\"primary\"\n              disabled={!isNextBtnEnabled}\n              onClick={() => {\n                mnemonicToSeed(mnemonic).then((seed) => {\n                  setSeed(seed);\n                  setNext(true);\n                });\n              }}\n            >\n              Next\n            </Button>\n          </CardActions>\n        </Card>\n      )}\n    </>\n  );\n}\n\nfunction DerivedAccounts({ goBack, mnemonic, seed, password }) {\n  const callAsync = useCallAsync();\n  const [dPathMenuItem, setDPathMenuItem] = useState(\n    DerivationPathMenuItem.Bip44Change,\n  );\n  const accounts = [...Array(10)].map((_, idx) => {\n    return getAccountFromSeed(\n      Buffer.from(seed, 'hex'),\n      idx,\n      toDerivationPath(dPathMenuItem),\n    );\n  });\n\n  function submit() {\n    callAsync(\n      storeMnemonicAndSeed(\n        mnemonic,\n        seed,\n        password,\n        toDerivationPath(dPathMenuItem),\n      ),\n    );\n  }\n\n  return (\n    <Card>\n      <AccountsSelector\n        showDeprecated={true}\n        accounts={accounts}\n        dPathMenuItem={dPathMenuItem}\n        setDPathMenuItem={setDPathMenuItem}\n      />\n      <CardActions style={{ justifyContent: 'space-between' }}>\n        <Button onClick={goBack}>Back</Button>\n        <Button color=\"primary\" onClick={submit}>\n          Restore\n        </Button>\n      </CardActions>\n    </Card>\n  );\n}\n\nexport function AccountsSelector({\n  showRoot,\n  showDeprecated,\n  accounts,\n  dPathMenuItem,\n  setDPathMenuItem,\n  onClick,\n}) {\n  return (\n    <CardContent>\n      <div\n        style={{\n          display: 'flex',\n          justifyContent: 'space-between',\n        }}\n      >\n        <Typography variant=\"h5\" gutterBottom>\n          Derivable Accounts\n        </Typography>\n        <FormControl variant=\"outlined\">\n          <Select\n            value={dPathMenuItem}\n            onChange={(e) => {\n              setDPathMenuItem(e.target.value);\n            }}\n          >\n            {showRoot && (\n              <MenuItem value={DerivationPathMenuItem.Bip44Root}>\n                {`m/44'/501'`}\n              </MenuItem>\n            )}\n            <MenuItem value={DerivationPathMenuItem.Bip44}>\n              {`m/44'/501'/0'`}\n            </MenuItem>\n            <MenuItem value={DerivationPathMenuItem.Bip44Change}>\n              {`m/44'/501'/0'/0'`}\n            </MenuItem>\n            {showDeprecated && (\n              <MenuItem value={DerivationPathMenuItem.Deprecated}>\n                {`m/501'/0'/0/0 (deprecated)`}\n              </MenuItem>\n            )}\n          </Select>\n        </FormControl>\n      </div>\n      {accounts.map((acc) => {\n        return (\n          <div onClick={onClick ? () => onClick(acc) : {}}>\n            <BalanceListItem\n              key={acc.publicKey.toString()}\n              onClick={onClick}\n              publicKey={acc.publicKey}\n              expandable={false}\n            />\n          </div>\n        );\n      })}\n    </CardContent>\n  );\n}\n\n// Material UI's Select doesn't render properly when using an `undefined` value,\n// so we define this type and the subsequent `toDerivationPath` translator as a\n// workaround.\n//\n// DERIVATION_PATH.deprecated is always undefined.\nexport const DerivationPathMenuItem = {\n  Deprecated: 0,\n  Bip44: 1,\n  Bip44Change: 2,\n  Bip44Root: 3, // Ledger only.\n};\n\nexport function toDerivationPath(dPathMenuItem) {\n  switch (dPathMenuItem) {\n    case DerivationPathMenuItem.Deprecated:\n      return DERIVATION_PATH.deprecated;\n    case DerivationPathMenuItem.Bip44:\n      return DERIVATION_PATH.bip44;\n    case DerivationPathMenuItem.Bip44Change:\n      return DERIVATION_PATH.bip44Change;\n    case DerivationPathMenuItem.Bip44Root:\n      return DERIVATION_PATH.bip44Root;\n    default:\n      throw new Error(`invalid derivation path: ${dPathMenuItem}`);\n  }\n}\n"]},"metadata":{},"sourceType":"module"}